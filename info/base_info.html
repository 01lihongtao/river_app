<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../asset/css/mui.min.css" rel="stylesheet" />
		<link href="../asset/css/iconfont.css" rel="stylesheet" />
		<link href="../asset/css/style.css" rel="stylesheet" />
		<style>
			.img_item {
				max-height: 200px;
				max-width: 200px;
			}
			
			.big_pic img {
				width: 100%;
			}
			#site_message{
				left:10px;
				width:100px;
				color:black;
				padding:5px;
			}
		</style>
	</head>

	<body onload="app.route()">
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>

			<a id="btn_rectification_to_rectification" class="mui-btn mui-btn-link mui-pull-right"></a>
			<h1 class="mui-title" id="name"></h1>
		</header>
		<div class="mui-content">
              <div class='mui-table-view'>
               		<button type="button" id="site_message" class="mui-btn mui-btn-outlined mui-table-view">站点动态信息</button>
               </div>
               <ul id="list-option" class="mui-table-view">
               	
               		<li class="mui-table-view-cell">
				       当前水位
				   	<span id="nowWatweLevel" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">   
				 </li>
					<li class="mui-table-view-cell">
				        当前闸门工况
				    <span id="gateOpenClose" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">  
				   </li>
				   <li class="mui-table-view-cell">
				     当前水泵工况
				   <span id="pumpOpenClose" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">  
				   </li>
               </ul>
                 <div class='mui-table-view'>
               		<button type="button" id="site_message" class="mui-btn mui-btn-outlined mui-table-view">站点静态信息</button>
                </div>
			<ul id="list-option" class="mui-table-view">
				<li class="mui-table-view-cell">
					管理人员姓名	<span id="g_user" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">   
				</li>
					<li class="mui-table-view-cell">
				       联系方式
				   	<span id="tel_phone" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">   
				 </li>
				 	<li class="mui-table-view-cell">
				       片区
				   	<span id="pianqu" style="max-width: 100%;" class="mui-pull-right mui-ellipsis"> 
				 </li>
				 	<li class="mui-table-view-cell">
				       行政区
				   	<span id="xingzhengqu" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">   
				 </li>
				 	<li class="mui-table-view-cell">
				       编码
				   	<span id="bianma" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">   
				 </li>

			  <li class="mui-table-view-cell">
					<i class="iconfont icon-heliu"></i> 站点类型：
					<span id="siteType" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
			
					<li class="mui-table-view-cell">
					<i class="iconfont icon-date1"></i> 建造（改造）年月
					<span id="build_date" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-zha"></i> 单 / 套闸
					<span id="single_suite" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-chicuncanshu"></i> 闸孔尺寸
					<span id="gate_hole_size" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-zhamenkaidu"></i> 闸门起闭方式
					<span id="gate_door_open_method" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				
				<li class="mui-table-view-cell">
					<i class="iconfont icon-heliu"></i> 口门：
					<span id="entrance" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-tuceng"></i> 水泵①型号 / 流量
					<span id="water_pump" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-heliu"></i> 启闭机电动机功率：
					<span id="hoistPow" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
			   <li class="mui-table-view-cell">
					<i class="iconfont icon-heliu"></i> 水泵电动机功率：
					<span id="pumpPow" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-heliu"></i> 管理房建筑面积：
					<span id="mngRoomBuildArea" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-heliu"></i> 绿化面积：
					<span id="greenArea" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
			
			
			
			
			
				<li class="mui-table-view-cell">
					<i class="iconfont icon-weizhibiaoji"></i> 围栏长度
					<span id="enclosureLen" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				
					<li class="mui-table-view-cell">
					<i class="iconfont icon-hedaoshuiwenzhan"></i>运行责任单位

					<span id="village" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				  </li>
				
				
				
				
				
				
<!--				
				<li class="mui-table-view-cell">
					<i class="iconfont icon-hedaoshuiwenzhan"></i> 行政村
					<span id="village" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>
				-->
			
				
				
				
				<!--<li class="mui-table-view-cell">
					<i class="iconfont icon-leibieguanli"></i> 类型
					<span id="type" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>-->
				<!--<li class="mui-table-view-cell">
					<i class="iconfont icon-shuliang"></i> 水泵数量
					<span id="water_pump_count" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>-->
				
				<!--<li class="mui-table-view-cell">
					<i class="iconfont icon-dituleiwanggequ"></i> 所属控制区
					<span id="control_area" style="max-width: 100%;" class="mui-pull-right mui-ellipsis">
					</span>
				</li>-->
				<!--<li class="mui-table-view-cell">
					<i class="iconfont icon-xinxi"></i> 备注
					<p id="memo">
					</p>
				</li>-->
				<!--<li class="mui-table-view-cell">
					<div class="big_pic">
						<img id="url_img_thumb" src="">
					</div>

				</li>-->

			</ul>
		</div>
	</body>
	<script src="../asset/js/jquery-3.3.1.min.js"></script>

	<script src="../asset/js/mui.min.js"></script>
	<script src="../asset/js/app.js"></script>
	<script type="text/javascript" charset="utf-8">
		var id = app.getUrlParam('id');
		console.log(id)
		var user_data = JSON.parse(app.getSetting('user_data') || '[]')
		mui.init();
		mui.ready(function() {

			app.ajax(app.url1('facilityUnite/monitoring/queryAllFacilityWaterNew'), {
				facilityInfoId: id,
//				inspectionType:"8501"
			}, function(ret) {
				console.log('具体数据'+JSON.stringify(ret))
				if(ret.code == 200) {
					
					var data = ret.data[0];
					console.log('详细的信息'+JSON.stringify(data))
                    $('#nowWatweLevel').html('4.20 / 3.50') //当前水位
                    $('#gateOpenClose').html('开启') //闸门工况
                    $('#pumpOpenClose').html('开启')
					$("#name").html(data.name)
					
					$('#g_user').html()  //管理人员
					$('#tel_phone').html() //联系方式
					$('#pianqu').html() //片区
					$('#xingzhengqu').html() //行政区
					$('#bianma').html() //编码
					$("#build_date").html(data.build_date) //建造年月
					$('#siteType').html() //站点类型
					$("#single_suite").html(data.single_suit) //单闸套闸
					$("#gate_hole_size").html(data.gate_hole_size) //闸空尺寸
					$("#gate_door_open_method").html(data.gate_door_open_method) //闸门启闭方式
					$('#entrance').html() //口门
					$("#water_pump_count").html(data.water_pump_count) //水泵数量 / 型号 / 流量

					$('#hoistPow').html//启闭机电动机功率
					$('#pumpPow').html()//水泵电动机功率
					$('#mngRoomBuildArea').html() //管理房建筑面积
					$('#greenArea').html() //绿化面积
					$('#enclosureLen').html() //围栏长度
					$("#village").html(data.village) //责任运行单位
					
					//					if(data.street)
//					$("#street").html(data.townName)  //城镇
					//					else
					//					$("#street").parent().hide()

					//					if(data.village)
				
					//					else
					//					$("#village").parent().hide()

//					$("#water_pump").parent().hide()   

//					$("#river").html(data.river)
					
					
					
				
//					$("#type").html(data.type)
//					$("#control_area").html(data.control_area)
//					$("#memo").html(data.memo)
					$("#url_img_thumb").attr("src", (data["url_img_thumb"] ? (app.prefix(data["url_img_thumb"])) : "../asset/images/empty_big.png"))
					app.ajax(app.url('query/info/my_concern'), {
							user_id: user_data.id,
						},
						function(res) {
							if(res.code == 0) {

								for(var i = 0; i < res.data.length; i++) {
									facility_id_arr.push(res.data[i]["facility_id"])
								}
								if(facility_id_arr.indexOf(id) == -1) {
									$("#btn_rectification_to_rectification").html("关注")
								} else {
									$("#btn_rectification_to_rectification").html("取消关注")
								}
							} else {
								mui.toast(ret.error);
							}
						}
					)
				} else {
					mui.toast(ret.error);
				}
			});

		})
		var facility_id_arr = [];
		mui.plusReady(function() {
			plus.screen.lockOrientation("portrait-primary");
		});

		$("#site_message").click(function(){
				app.open("../operation_state.html")
		})
		$("#btn_rectification_to_rectification").click(function() {
			if($("#btn_rectification_to_rectification").html()=="取消关注"){
				facility_id_arr.remove(id)
			}
			if($("#btn_rectification_to_rectification").html()=="关注"){
				facility_id_arr.push(id)
			}
			
			var xhr = new XMLHttpRequest();
			var formData = new FormData();
			xhr.timeout = 120000;
			var upload = plus.nativeUI.showWaiting('上传中...');

			xhr.ontimeout = function(e) {
				mui.toast('请求超时，请再网络状态良好的地方重试');
				upload.close()
			};

			formData.append("user_id", user_data.id);
			for(var i = 0; i < facility_id_arr.length; i++) {

				formData.append("items", facility_id_arr[i]);
			}

			xhr.onreadystatechange = function(e) {

				if(xhr.readyState == 4) {
					console.log(xhr.responseText)

					if(xhr.status == 200) {
						var ret = JSON.parse(xhr.responseText);
						if(ret.code == 0) {
							
							if(facility_id_arr.indexOf(id) == -1) {
								$("#btn_rectification_to_rectification").html("关注")
								mui.toast('取消关注成功');
							} else {
								$("#btn_rectification_to_rectification").html("取消关注")
								mui.toast('关注成功');
							}
						} else {
							if(ret.error)
								mui.toast(ret.error);
							else
								mui.toast(ret.desc);
						}

					} else {

						mui.toast('关注失败');

					}
					upload.close()
					return;
				}
			}

			xhr.open('POST', app.url('save/my_concern'), true);
			xhr.send(formData);

		})
	</script>

</html>