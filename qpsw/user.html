<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="./css/mui.min.css">
		<link rel="stylesheet" href="./css/iconfont.css">
		<link href="css/style.css" rel="stylesheet" />
		<style>
			html,
			body {
				background-color: #efeff4;
			}  
			
			.mui-table-view {
				margin-top: 20px;
			}
			
			.mui-table-view span.mui-pull-right {
				color: #999;
			}
			
			.mui-table-view-divider {
				background-color: #efeff4;
				font-size: 14px;
			}
			
			.mui-table-view-divider:before,
			.mui-table-view-divider:after {
				height: 0;
			}
			
			.head {
				height: 40px;
			}
			
			#head {
				line-height: 40px;
			}
			
			.head-img {
				width: 40px;
				height: 40px;
			}
			
			#head-img1 {
				position: absolute;
				bottom: 10px;
				right: 40px;
				width: 40px;
				height: 40px;
			}
			
			#user_role {
				color: gray;
			}
			
			.span-value {
				color: red;
			}
			
			.gray-value {
				color: gray;
			}
			
			#btn_evidence_add {
				right: 155px;
				display: none;
			}
			
			#btn_sign {
				right: 110px;
				display: none;
			}
			
			#btn_list {
				right: 60px;
			}
			
			#action_list_evid {
				display: none;
			}
			
			#action_list_check {
				display: none;
			}
			
			#action_list_rectify {
				display: none;
			}
			
			#action_list_sign {
				display: none;
			}
			
			#action_list_monitor {
				display: none;
			}
			
			#btn_report {
				display: none;
			}
		</style>
	</head>

	<body onload="app.route()">
		<header class="mui-bar mui-bar-nav">
			<a class="link_open mui-btn mui-btn-link mui-pull-right" href="settings.html">设置</a>
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">用户信息</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell mui-media">
					<img class="mui-media-object mui-pull-left head-img" id="head-img" src="./images/user.png">
					<div class="mui-media-body">
						<span id="login_name">(空)</span>
						<div id="user_role" class='mui-ellipsis'>(空)</div>
					</div>
				</li>
			</ul>

			<ul class="mui-table-view">
				<li class="mui-table-view-cell" style="display: none;">
					<i class="iconfont icon-wode"></i> <span id="text_user_name">(空)</span>
					<a id="btn_evidence_add" type="button" class="link_open mui-btn mui-btn-primary" href="op_evidence.html">
						<i class="iconfont icon-camera"></i>
					</a>
					<a id="btn_sign" type="button" class="link_open mui-btn mui-btn-primary" href="op_sign.html">
						<i class="iconfont icon-edit"></i>
					</a>
					<a id="btn_report" type="button" class="link_open mui-btn mui-btn-primary" href="#popover_report">
						<i class="iconfont icon-baobiao"></i>
					</a>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-iccompany"></i> <span id="text_company">(空)</span>
				</li>
				<li class="mui-table-view-cell">
					<i class="iconfont icon-login"></i> 已登录 <span id="text_online_h" class="span-value">0</span> 小时 <span id="text_online_m"
					 class="span-value">0</span> 分
				</li>
			
				<li class="mui-table-view-cell" style="display: none;">
					<i class="iconfont icon-time"></i> 上次报位时间 <span id="text_last_gps_time" class="gray-value" style="float: right;"></span>
				</li>
				<li class="mui-table-view-cell" style="display: none;">
					<i class="iconfont icon-time"></i> 上次报位坐标 <span id="text_last_gps" class="gray-value"></span>
				</li>
				<li class="mui-table-view-cell" style="display: none;">
					<i class="iconfont icon-time"></i> 上次报位精度 <span id="text_last_gps_accuracy" class="gray-value"></span>
				</li>
			</ul>
			<div class="mui-content-padded">
				<button id="a-logout" type="button" class="mui-btn mui-btn-danger mui-btn-block"><i class="iconfont icon-tuichu"></i>
					退出登录</button>
			</div>
		</div>

		<div id="popover_report" class="mui-popover mui-popover-action mui-popover-bottom">
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a class="link_open" href="report_list_bj.html">保洁报表</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="link_open" href="report_list_jx.html">绩效报表</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="link_open" href="report_sta_sign.html">签到统计</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="link_open" href="report_sta_evidence.html">取证信息查询</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#popover_report"><b>取消</b></a>
				</li>
			</ul>
		</div>

		<div id="popover_list" class="mui-popover mui-popover-action mui-popover-bottom">
			<ul class="mui-table-view">
				<li id="action_list_alarm" class="mui-table-view-cell">
					<a class="link_open" href="list_alarm.html">违规报警违规报警</a>
				</li>
				<li id="action_list_evid" class="mui-table-view-cell">
					<a class="link_open" href="list_evidence.html">取证列表</a>
				</li>
				<li id="action_list_check" class="mui-table-view-cell">
					<a class="link_open" href="list_check.html">检查列表</a>
				</li>
				<li id="action_list_rectify" class="mui-table-view-cell">
					<a class="link_open" href="list_rectify.html">整改列表</a>
				</li>
				<li id="action_list_sign" class="mui-table-view-cell">
					<a class="link_open" href="list_sign.html">签到列表</a>
				</li>
				<li id="action_list_monitor" class="mui-table-view-cell">
					<a class="link_open" href="search.html">监控对象列表</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a href="#popover_list"><b>取消</b></a>
				</li>
			</ul>
		</div>
	</body>

	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="./js/mui.min.js"></script>
	<script src="./js/app.js"></script>
	<script>
		mui.init();

		var a_logout = document.querySelector('#a-logout');
		var span_login_name = document.getElementById('login_name');
		var div_user_role = document.getElementById('user_role');

		var text_user_name = document.getElementById('text_user_name');
		var text_company = document.getElementById('text_company');
		var text_online_h = document.getElementById('text_online_h');
		var text_online_m = document.getElementById('text_online_m');
		var text_patrol_distance = document.getElementById('text_patrol_distance');
		var text_count_evidence = document.getElementById('text_count_evidence');
		var text_count_check = document.getElementById('text_count_check');
		var text_count_rectify = document.getElementById('text_count_rectify');

		var btn_evidence_add = document.getElementById('btn_evidence_add');
		var btn_my_evidence = document.getElementById('btn_my_evidence');
		var btn_evidence_process = document.getElementById('btn_evidence_process');
		var btn_evidence_rectification = document.getElementById('btn_evidence_rectification');

		var isWaiting = false;

		mui.ready(function() {

			var user_role = app.getDepartUserRole();

			a_logout.addEventListener('tap', function() {
				if (isWaiting)
					return;

				var btnArray = ['取消', '是'];
				mui.confirm('是否退出登录？', '确认', btnArray, function(e) {
					if (e.index == 1) {
						app.removeSetting('remember_me');
						app.removeSetting('user_name');
						app.removeSetting('user_pwd');
						app.removeSetting('user_data');

						//	app.removeSetting('event_list');

						//plus.webview.clear();

						//	app.open('login.html');

						app.openBack('../fuse.html');
					}
				})
			})

			// login name
			var login_name = app.getLoginName();
			if (login_name)
				span_login_name.innerHTML = login_name;

			// role name
			if (user_role)
				div_user_role.innerHTML = user_role;

			text_user_name.innerHTML = app.getUserName();
			text_company.innerHTML = app.getCompanyName() + " " + app.getDepartmentName();

			var onlineTime = (new Date()).getTime() - app.getSetting('login_time');
			var result = app.formatSeconds(onlineTime / 1000);
			text_online_h.innerHTML = result[0];
			text_online_m.innerHTML = result[1];

			//		loadUserInfo();

			initCtrls();
		})

		mui.plusReady(function() {});

		function loadUserInfo() {
			app.showProgressBar();
			app.ajax(app.url('api/user/info'), {
				userId: app.getUserId()
			}, function(ret) {
				app.showProgressBar(false);
				if (ret.code == 200) {
					//					console.log(JSON.stringify(ret.data))
					//		text_count_evidence.innerHTML = ret.data.obtainEvidenceCount;
					//		text_patrol_distance.innerHTML = (ret.data.patrolMileage / 1000.0);

					// text_count_check
					// text_count_rectify
					//ret.data.unprocessedAlarmCount;
					//ret.data.userDepartment;
				} else {
					mui.toast(ret.desc);
				}
			})
		}

		function initCtrls() {
			// 河道科 - 管理员
			if (app.isHdAdmin() || app.isTest()) {
				$('#btn_evidence_add').show();
				$('#action_list_evid').show();

				if (app.isTest()) {
					$('#btn_sign').show();

					$('#action_list_check').show();
					$('#action_list_rectify').show();
					$('#action_list_sign').show();
					$('#action_list_monitor').show();
					$('#btn_report').show();
				}
			}
			// 河道科 - 监理员
			else if (app.isHdJl()) {
				$('#btn_evidence_add').show();
				$('#action_list_evid').show();
			}
			// 河道科 - 巡查员
			else if (app.isHdXc()) {
				$('#li_yxc').show();

				$('#btn_evidence_add').show();
				$('#action_list_evid').show();
			}
			// 水闸科 - 管理员
			else if (app.isSzAdmin()) {
				$('#btn_evidence_add').show();
				$('#action_list_evid').show();
			}
			// 水闸科 - 监理员
			else if (app.isSzJl()) {
				$('#btn_evidence_add').show();
				$('#action_list_evid').show();
			}
			// 水闸科 - 巡查员
			else if (app.isSzXc()) {
				$('#btn_evidence_add').show();

			}
			// 养护单位
			else if (app.isYf()) {
				$('#action_list_evid').show();
			}

			$('#text_last_gps_time').text(app.getSetting("lastPostPointTime"));
			$('#text_last_gps').text(app.getSetting("last_gps"));

			var arrGps = app.getSetting('current_gps').split(',');
			if (arrGps.length > 3)
				$('#text_last_gps_accuracy').text(arrGps[3]);
		}

		$('.link_open').click(function() {
			mui('#' + $(this).parents('div').attr('id')).popover('hide');
			app.open($(this).attr('href'));
			return false;
		})
	</script>

</html>
