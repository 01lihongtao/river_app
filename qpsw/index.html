<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>首页</title>
		<link href="./new_demo/css/mui.css" rel="stylesheet" type="text/css" />
		<link href="./new_demo/css/iconfont.css" rel="stylesheet" type="text/css" />
		<link href="css/iconfont.css" rel="stylesheet" />
		<link href="./new_demo/css/ol.css" rel="stylesheet" type="text/css" />
		<link href="css/style.css" rel="stylesheet" />
		<style type="text/css">
			.map {
				top: 45px;
				height: calc(100vh);
				width: 100%;
				position: absolute;
			}

			.map-btn {
				position: absolute;
				z-index: 200;
				right: 5px;
				width: 48px;
				height: 48px;
			}

			.map-btn i {
				font-size: 16px;
				line-height: 20px;
			}

			.map-btn p {
				font-size: 12px;
				line-height: 12px;
			}

			#btn-person {
				top: 140px;
				z-index: 999999999;
			}

			#btn-ship {
				top: 90px;
				z-index: 999999999;
			}

			#btn-review {
				top: 190px;
				z-index: 999999999;
			}

			#btn-mine {
				top: 240px;
			}

			#btn-layer {
				top: 260px;
			}

			body {
				overflow-y: hidden;
			}

			#container {
				width: 100%;
				height: calc(100vh - 45px);
				margin-top: 45px;
			}

			.amap-toolbar {
				padding-top: 50px;
			}




			.map-btn {
				position: absolute;
				z-index: 200;
				right: 10px;
				width: 48px;
				height: 48px;
			}

			.map-btn i {
				font-size: 24px;
				line-height: 24px;
			}

			.map-btn p {
				font-size: 12px;
				line-height: 12px;
			}

			.mui-badge .mui-badge {
				position: relative;
				left: 0px;
				z-index: 201;
			}

			#btn-msg {
				top: 90px;
			}

			.someClassName {
				background-color: gray;
				color: white;
			}

			.userClassName {
				background-color: gray;
				color: white;

			}


			.user-avatar {
				width: 28px;
				height: 28px;
				border-radius: 28px;
				-moz-border-radius: 28px;
				border: 1px solid #a1a1a1;
				padding: 2px;
				margin-left: 3px;
			}

			#input-search {
				width: 100%;
				height: 28px;
				margin-top: 6px;
				margin-left: 6px;
				background-color: rgba(0, 0, 0, 0.1);
				border: 0;
				border-radius: 6px;
				padding-top: 0;
				padding-bottom: 0;
			}

			#a-tree i {
				border: 1px solid white;
				padding: 3px;
			}

			#a-tree.checked i {
				border: 1px solid #007AFF;
				padding: 3px;
			}

			.checked,
			.checked p {
				color: #0062cc;
				border-color: #0062cc;
			}

			.mui-table-view-cell:after {
				background-color: inherit;
			}

			.mui-table-view-cell {
				border-bottom: 1px solid #c8c7cc;
			}

			.mui-popover {
				z-index: 99999
			}

			.button-group {
				position: relative;
				text-align: center;
				margin-top: 20px;
			}

			.info_row {
				text-align: left;
				width: 80%;
				margin: 5px auto;
			}


			.mui-table-view-cell>a.a_tree_area {
				color: #0062cc;
			}

			.serach_input {
				position: fixed;
				width: 100%;
				background-color: white;
				height: 42px;
				z-index: 99999999;
				top: 45px;
				padding-left: 30px;

			}

			.serach_input .mui-search {
				magin-left: 10px;
			}

			#txt_obj_name {

				margin-left: 40px;
				*/
			}

			.text_ship_type {
				color: royalblue;
			}

			.ol-popup {
				height: 180px;
				width: 280px;
				background-color: white;
				border: 1px solid #e8e8e8;
				border-radius: 5px;
				display: none;
			}

			.search_count {
				max-height: 120px;
				min-height: 45px;
				overflow-y: scroll;
				width: 80%;
				display: inline-block;
				border: 1px solid #E0E0E0;
				background-color: white;
				/* z-index: 9999; */
				margin-top: -10px;
				/* display:none; */
			}

			#navi {
				position: absolute;
				background-color: royalblue;
				color: white;
				margin-top: 120px;
				left: 5px;
			}

			#travel {
				position: absolute;
				background-color: royalblue;
				color: white;
				margin-top: 120px;
				right: 5px;
			}

			#wake {
				position: absolute;
				background-color: royalblue;
				color: white;
				margin-top: 120px;
				right: 55px;
			}

			.ClassName {
				list-style: none;
				padding: 0px 5px;
			}

			#div_tree.role_hd_admin {

				display: inline-block;
			}


			#li_rectification.role_hd_admin {
				display: block;
			}

			#li_check.role_hd_admin {
				display: block;
			}

			#li_sign.role_hd_admin {
				display: block;
			}

			#li_be_inspect.role_hd_admin {
				display: block;
			}

			#ul_tree_list2 {
				display: none;
			}

			#ul_tree_list3 {
				display: none;
			}

			#div_tree {
				position: absolute;
				top: 0px;
				left: 0px;
				z-index: 10000000000;
				display: none;
			}

			#div_tree.role_hd_admin {
				display: inline-block;
			}

			#div_tree a {
				/* padding-left:40px; */
				padding: 4px;
				padding-top: 9px;
			}

			#div_tree a i {
				font-size: 20px;
			}

			#left-tree {
				position: fixed;
				width: 300px;
				/* opacity: 0.8; */
				background-color: white;
				left: -160px;
				padding-left: 25px;
				top: 80px;
				z-index: 1000000000;
				max-height: calc(100% - 45px);
				overflow-y: scroll;
				display: none;
			}

			#left-tree span.tree_item_text {
				margin: 0;
				padding: 0;
				border: none;
				display: inline;
				margin-left: 20px;
			}

			#left-tree .no_childnode {
				margin: 0;
				padding: 0;
				border: none;
				display: block !important;
				margin-left: 20px;
				float: right !important;

			}

			.son_css {
				margin-left: 12px;
			}

			#query_search {
				/* width:80%;
				border:1px solid red;
				margin-left:20% */
			}

			#div_search {
				margin: 0 27px 0 0;
			}

			#div_search.role_hd_admin {
				margin: 0 27px;
			}
			#id_title{
				padding:5px;
			}
			#title_nav{
				margin-left:10px;
			}
		</style>
		<!-- 字体相关 -->
		<link rel="stylesheet" type="text/css" href="./new_demo/lib/css/iconfont.css" />
		<!-- 弹出框样式 -->
		<link rel="stylesheet" type="text/css" href="./new_demo/css/popup.css" />
	</head>
	<body onload="app.route()">
		<header class="mui-bar mui-bar-nav mui-row">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">地图导航</h1>
		</header>
		<!-- 这是搜索部分 -->
		<div class="serach_input">
			<div class="mui-input-row mui-search">
				<input type="search" id="query_search" class="mui-input-clear" placeholder="请输入船名或人员">
			</div>
			<div id="div_tree" class="ctrl_role mui-pull-left">
				<a id="a-tree" class="mui-icon" href="javascript:void(0);"><i class="iconfont icon-list4f"></i></a>
			</div>
			<ul id="search_count" class="search_count">

			</ul>

		</div>
		<div id="left-tree" class="tree">
			<nav id="nav_type" class="mui-bar-tab">
				<a class="mui-tab-item mui-active" href="#">
					养护
				</a>
				<a class="mui-tab-item" href="#">
					监理
				</a>
				<a class="mui-tab-item" href="#">
					巡查
				</a>
			</nav>
			<ul id="title_nav" class="mui-table-view">
			<li ><button type="button" class="mui-btn mui-btn-primary" id="id_prev">后退</button></li>
			<li id="id_title"></li>
			</ul>
			<ul id="ul_tree_list" class="mui-table-view">


			</ul>
			<ul id="ul_tree_list2" class="mui-table-view">
			</ul>
			<ul id="ul_tree_list3" class="mui-table-view">
			</ul>
		</div>
		<div class="mui-content">
			<a id="btn-ship" class="mui-btn map-btn"><i class="iconfont icon-chuan"></i>
				<p>船舶</p>
			</a>
			<a id="btn-person" class="mui-btn map-btn"><i class="iconfont icon-zhifarenyuan"></i>
				<p>人员</p>
			</a>
			<a id="btn-review" class="mui-btn map-btn" href="#popover-review"><i class="iconfont icon-baobiao"></i>
				<p>围栏</p>
			</a>
			<a id="btn-mine" class="mui-btn map-btn"><i class="iconfont icon-gongneng"></i>
				<p>水系图</p>
			</a>

			<img id="locationImg" style="position: absolute;bottom: 44px;left: 16px;z-index: 666;background-color: white;width:25px"
			 src="./new_demo/asset/images/dingwei.png" />
			<div id="map" class="map"></div>
			<!-- <div id="">
				<img id="dituCenter" src="asset/images/ditu-center.png" />
			</div> -->

			<div id="">
				<img id="dituCenter" src="images/ditu-center.png" />
			</div>

			<div id="popover-layer" class="mui-popover mui-popover-action mui-popover-bottom">
				<ul class="mui-table-view mui-table-view-striped mui-table-view-condensed">
					<li class="mui-table-view-cell">
						天地图矢量底图
						<div id="switch_tiandi1" class="mui-switch mui-switch-blue mui-switch-mini mui-active">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						天地图矢量注记
						<div id="switch_tiandi2" class="mui-switch mui-switch-blue mui-switch-mini mui-active">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						天地图遥感影像
						<div id="switch_tiandi3" class="mui-switch mui-switch-blue mui-switch-mini mui-active">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						闵行水系图
						<div id="switch_qp5" class="mui-switch mui-switch-blue mui-switch-mini mui-active">
							<div class="mui-switch-handle"></div>
						</div>
					</li>
				</ul>
			</div>
			<div id="popup" class="ol-popup">
				<a href="#" id="popup-closer" class="ol-popup-closer"></a>
				<button id="navi">导航</button>
				<button id="wake">尾迹</button>
				<button id="travel">轨迹</button>
				<div id="popup-content"></div>
			</div>
		</div>
	</body>
	<!-- 第三方 -->
	<script src="./new_demo/js/jquery-3.3.1.min.js"></script>
	<script src="./new_demo/js/ol.js"></script>
	<script src="./new_demo/js/ol/proj.js"></script>
	<script src="./new_demo/js/mui.js"></script>
	<script src="https://webapi.amap.com/maps?v=1.4.15&key=366357a89ebbb8019eb0d86d19b3bacb"></script>
	<script src="./new_demo/js/LonLatUtil.js"></script>
	<!-- 自有 -->
	<script src="./js/app.js"></script>
	<script src="./new_demo/js/index/layerInfoService.js"></script>
	<script src="./new_demo/js/index/mapService.js"></script>
	<script src="./new_demo/js/base/versionService.js"></script>
	<script src="./new_demo/js/base/backService.js"></script>
	<script src="./new_demo/js/index/dictService.js"></script>
	<script src="./new_demo/js/index/uploadService.js"></script>
	<script src="./new_demo/js/index/inspectWaterQualityInfoService.js"></script>
	<script src="./new_demo/js/index/inspectOutfalReportInfoService.js"></script>
	<!-- 主程序 -->
	<script type="text/javascript" charset="utf-8">
		var startAndEndTime = {};
		//上传相关用
		var uploadInterval = null; //上传定时器
		//地图对象
		var switchTiandi1 = null;
		var switchTiandi2 = null;
		var switchTiandi3 = null;
		var switchQp5 = null;
		var dituCenter = null;
		var geocoderResult = null; //跳转到取证页面传的值，每一次传值后要设置为null

		var btnShip = null; //船舶
		var btnPerson = null; //人员
		var btnReview = null;
		var btnMine = null;
		var btnLayer = null;
		var locationImg = null; //定位按钮
		var search_count = null; //搜索内容
		var watchGpsId = null;
		var timer = null;
		var current_tree_type_now = 0;

		//获取公司所属资源
		var resData = null; //主控台资源结构树


		var data_finished = {}
		var data_prevLevel;
		var data_currentLevel;
		var uuid_prev;

		// var all_location_lonlat=[]
		var a_tree = document.getElementById('a-tree');
		$("#search_count").hide()
		$("#popup").css("display", "none");
		//关闭按钮
		var closer = document.getElementById('popup-closer');
		// $("#popup").hide()
		$(document).ready(function() {
			mui.init();
			mui.plusReady(function() {
				a_tree.addEventListener('tap', function() {

					if (this.classList.contains('checked')) {
						this.classList.remove('checked');
					} else {
						this.classList.add('checked');
					}
				
					// getData_currentLevel()
					togglePanelTree();
				})

				getTree(100811)

				//授权
				initPermission()
				setTimeout(function() {
					$("#popup").css("display", "block");
					// $("#search_count").css("display","block")
					// $("#popup").show()
				}, 3000)
			})
		});

		function getNowTime(newDate) {
			var date = newDate ? newDate : new Date();
			var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
			var strDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
			var house = date.getHours() < 10 ? '0' + date.getHours() : date.getHours()
			var minutes = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes()
			var seconds = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds()

			var currentdate = date.getFullYear() + "-" + month + "-" + (strDate - 1) + " " + house + ":" + minutes + ":" +
				seconds;
			return currentdate;
		}

		function initPermission() {
			plus.android.requestPermissions([
				'android.permission.ACCESS_FINE_LOCATION', //定位
				'android.permission.WRITE_EXTERNAL_STORAGE', //存储
				'android.permission.CAMERA' //拍照或者拍视频
			], function(e) {
				if (e.deniedAlways.length > 0) { //权限被永久拒绝
					// 弹出提示框解释为何需要定位权限，引导用户打开设置页面开启
					console.log('Always Denied!!! ' + e.deniedAlways.toString());
					// TODO 强制系统退出
					plus.runtime.quit();
				}
				if (e.deniedPresent.length > 0) { //权限被临时拒绝
					// 弹出提示框解释为何需要定位权限，可再次调用plus.android.requestPermissions申请权限
					console.log('Present Denied!!! ' + e.deniedPresent.toString());
					// TODO 强制系统退出
					plus.runtime.quit();
				}
				if (e.granted.length > 0) { //权限被允许
					//初始化视图
					initView();
					//初始化监听器
					initListener();
					//获取图层信息
					getLayerInfo();
					//初始化一些网络请求
					initNetworkData();
					//退出按钮监听
					// initQuit();
				}
			}, function(e) {
				console.log('Request Permissions error:' + JSON.stringify(e));
			});
		}
		// 关于树
		$('#div_tree').addClass('role_hd_admin');

		function togglePanelTree() {
			var strId = "#left-tree";
			if ($(strId).is(':visible')) {
				var aniBottomWidth = "-" + $(strId).width() + "px";
				$(strId).animate({
					left: aniBottomWidth
				}, 300, function() {
					$(strId).hide();
				})
			} else {
				$(strId).show();
				$(strId).animate({
					left: "0px"
				}, 300, function() {

				})
			}
		}

		mui('#nav_type').on('tap', '.mui-tab-item', function() {
			current_tree_type = this.innerText;
			if (current_tree_type == '养护') {
				$('#ul_tree_list').show();
				$('#ul_tree_list2').hide();
				$('#ul_tree_list3').hide();
				current_tree_type_now = 0
				getTree(100811)

				// $('#ul_tree_list').html(string)
			}
			// person
			else if (current_tree_type == '监理') {
				getTree('100813')
				$('#ul_tree_list').hide();
				$('#ul_tree_list2').show();
				$('#ul_tree_list3').hide();
				current_tree_type_now = 1
			}
			// person
			else if (current_tree_type == '巡查') {
				getTree('100812')
				$('#ul_tree_list').hide();
				$('#ul_tree_list2').hide();
				$('#ul_tree_list3').show();
				current_tree_type_now = 2
			}
		})




		function getTree(value) {
			var params = {
				typeResourceGroup: value
			}
			app.ajax2(app.url('/getTree'), params, function(ret) {
				// console.log('树' + JSON.stringify(ret))
				if (ret.code == 200) {
					// init_html(ret.data)
					
					init_mh(ret.data)
					document.getElementById("id_prev").addEventListener('tap', function() {
						getData_withUUID("prev",uuid_prev)
					});
					createElement_mh()
				}

			})
		}

		
		// 树封装
		//解构数据重新装载
		function dataDeconstruction(data, prevUUID) {
			for (var index = 0; index < data.length; index++) {
				var element = data[index];
				if (prevUUID) {
					element.prevUUID = prevUUID
				}
				var uuid = element.unique ? element.unique : element.uuid
				element.uuid = uuid
				data_finished[uuid] = element

				if (element.objList) {
					element.children = element.objList
				}
				if (element.objectName) {
					element.name = element.objectName
				}
				if (element.children) {
					dataDeconstruction(element.children, element.uuid)
				}
			}
		}

		function init_mh(data) { 
			data_finished={
				"top":{
					'children': data,
					'uuid': 'top',
					'name':'顶层',
					}
			}
			data_currentLevel = {
				'children': data,
				'uuid': 'top',
				'name':'顶层'
			}
			dataDeconstruction(data, 'top');
			
		}

		// function getData_finished() {
		// 	return data_finished
		// }

		function getData_withUUID(type, uuid) {
			switch (type) {
				case 'next':
					data_prevLevel = JSON.parse(JSON.stringify(data_currentLevel))
					data_currentLevel =JSON.parse(JSON.stringify(data_finished[uuid]))
					break;
				case 'prev':
					const prevUUID = data_currentLevel.prevUUID;
					data_currentLevel = JSON.parse(JSON.stringify(data_prevLevel))
					data_prevLevel = JSON.parse(JSON.stringify(data_finished[prevUUID]))
					break;

				default:
					break;
			}
			createElement_mh();
			return data_currentLevel
		}

		// function getData_prevLevel() {
		// 	return data_prevLevel
		// }

		// function getData_currentLevel() {
		// 	return data_currentLevel
		// }
		
		
		// ul.appendChild()
		function createElement_mh (){
			// data_currentLevel
			// console.log('当前组装的值'+JSON.stringify(data_currentLevel))
			
			// var sonStr=[]
			document.getElementById("id_title").innerHTML=data_currentLevel.name
			uuid_prev=data_currentLevel.prevUUID
			var ul = document.createElement('ul')
			ul.setAttribute('class','mui-table-view mui-table-view-chevron');
			console.log('装在后数据11'+data_currentLevel.uuid)
			for (var i = 0; i < data_currentLevel.children.length; i++) {
				// var sonData = data_currentLevel[i].children; //这是每个片区的值
				var parentdata = data_currentLevel.children[i];
				// console.log('名字'+JSON.stringify(parentdata.name))
				// 公司
				var li = document.createElement('li')
				li.setAttribute('class','mui-table-view-cell mui-collapse');
				var button = document.createElement('button')
				// button.setAttribute('value',parentdata.name)
				button.innerHTML=parentdata.name
				button.onclick=(function(param){
					
					return function(){
						if(param.children){
							getData_withUUID("next",param.uuid)
						}else {
							// alert('经纬度')
							if(param.objectType==100507){
								userDetail(param.id)
								togglePanelTree()
							}else if(param.objectType==100501){
								shipDetail(param.id)
								togglePanelTree()
							}
							// console.log('params'+JSON.stringify(param))
						}
						
					} 
				})(parentdata)
				li.appendChild(button)
				ul.appendChild(li)
			
		} 
		// var string=
		// '<div class="count_style">' +
		// 	'<ul class="mui-table-view mui-table-view-chevron">' +
		// 	sonStr+
		// 	'</ul>'
		// '</div>'
		if (current_tree_type_now == 0) {
			$('#ul_tree_list').html(ul)
		} else if (current_tree_type_now == 1) {
			$('#ul_tree_list2').html(ul)
		} else if (current_tree_type_now = 2) {
			$('#ul_tree_list3').html(ul)
		}
	
		}
     //人员详情
	  function userDetail(value){
		  var params={
			  userId:value
		  }
		  	app.ajax2(app.url('/gbac/selectUserCompanyInfo'), params, function(ret) {
				console.log('人员详情'+JSON.stringify(ret))
				if(ret.code==200){
					
				if(typeof(ret.data.lon) == "undefined"){
					mui.toast('没有经纬度');
				}else {
						mapService.test2(ret.data,'1');
					}
	
						
				}
				
			})
	  }
  // 船舶 
 function shipDetail(value){
		  var params={
			  objectId:value
		  }
		  	app.ajax2(app.url('/selectShip'), params, function(ret) {
				console.log('船舶详情'+JSON.stringify(ret.data[0]))
				if(ret.code==200){
					
				if(typeof( ret.data[0].lbsPositionList[0].lon) == "undefined"){
					mui.toast('没有经纬度');
				}else {
						mapService.test2(ret.data[0].lbsPositionList[0],'2');
					}
	
						
				}
				
			})
	  }

		mui('#list').on('tap', '.TextCenter2', function() {
			// console.log('5555')
			console.log('传过去的值是哪个？' + JSON.stringify(this.getAttribute('action')))
			// app.open("work_detail.html", this.getAttribute('action'));
		})


		function getLayerInfo() {
			var promise = layerInfoService.getLayerInfo();
			promise.then(function(ret) {
				var data = ret.data;
				// console.log('图层信息'+JSON.stringify(data))
				//初始化地图
				mapService.initMap(dituCenter, this.getGeoResultInfo, data);
				mapService.initLayerShowHide(switchTiandi1, switchTiandi2, switchTiandi3,
					switchQp5);
			}, function(ret) {
				mui.toast(ret.msg);
			});
		}

		function initView() {
			btnShip = $("#btn-ship"); //船舶
			btnPerson = $("#btn-person");
			btnReview = $("#btn-review"); //电子围栏
			btnMine = $("#btn-mine");
			btnLayer = $("#btn-layer");
			switchTiandi1 = $("#switch_tiandi1");
			switchTiandi2 = $("#switch_tiandi2");
			switchTiandi3 = $("#switch_tiandi3");

			switchQp5 = $("#switch_qp5");
			dituCenter = $("#dituCenter");
			locationImg = $("#locationImg");
			search_count = $("#search_count") //搜索内容

		}
		// 搜索事件
		document.getElementById("query_search").addEventListener('input', function() {
			var this_value = this.value
			if (this_value == "") {
				$("#search_count").hide()
			}
			var params = {
				objectName: this_value,
				resourceType: '',
			}
			var data = []
			app.ajax(app.url('lbs/position/app/list/last/from/resource'), params, function(ret) {
				console.log('url' + app.url('lbs/position/app/list/last/from/resource') + '参数' + JSON.stringify(params))
				if (ret.code == 200) {
					// clearTimeout(timer)
					// timer = setTimeout(function() {
					console.log('模糊搜索' + JSON.stringify(ret.data))
					var videoHtml = document.getElementById("search_count");
					videoHtml.innerHTML = ''
					data = ret.data;
					for (var i = 0; i < data.length; i++) {
						var but = document.createElement("li");
						but.innerHTML = data[i].objectName
						but.classList.add("ClassName")
						but.onclick = (function(param) {
							$("#search_count").hide()
							var childrenparam = param;
							return function() {
								click_jump_map(childrenparam)
							}
						})(data[i]);
						videoHtml.appendChild(but)
					}
					if (data.length > 0) {
						$("#search_count").show()
					} else {
						$("#search_count").hide()
					}
					// }, 500)
				}
			})
			console.log("input" + JSON.stringify(this_value))
		});
		//点击跳转在地图显示
		function click_jump_map(value) {
			console.log('点击的值' + JSON.stringify(value))
			$("#search_count").hide()
			// $("#popup").style.display='block'
			mapService.test(value);
		}


		function initListener() {
			/**
			 * 监听上一个页面fire返回【上传】
			 * @param {Object} e
			 */
			window.addEventListener('reloadWebview', function(e) {
				// console.log("---》刷新图层数据！")
				var currentWebview = plus.webview.currentWebview();
				currentWebview.reload(true); //设置页面重新加载项(默认为false，改为true)
				mapService.initVectorLayer();
			});

			// //开启地图移动监听
			window.addEventListener('openMapMoveendListener', function(e) {
				console.log("--->openMapMoveendListener");
				mapService.mapMoveListener(this.getGeoResultInfo);
			});

			//"船舶"按钮监听
			var shipFlag = true;
			btnShip.click(function() {
				if (shipFlag) {
					mapService.clearLayer()
					// document.getElementById("btn-ship").classList.remove("someClassName")
					shipFlag = false
				} else {
					mapService.initVectorLayer()
					// document.getElementById("btn-ship").classList.add("someClassName")

					shipFlag = true;
				}
			});

			//"电子围栏"按钮监听
			var review_flag = true;
			btnReview.click(function() {
				console.log('电子围栏')
				if (review_flag) {
					mapService.initVector_review_Layer()
					review_flag = false
				} else {
					mapService.clear_review_Layer()
					review_flag = true;
				}


			});

			//"水系图"按钮监听
			var waterFlag = true;
			btnMine.click(function() {
				if (waterFlag) {

					mapService.mhQp5(false)
					// document.getElementById("btn-mine").classList.add("userClassName")
					waterFlag = false
				} else {
					mapService.mhQp5(true)
					// document.getElementById("btn-mine").classList.remove("userClassName")
					waterFlag = true
				}
				// app.open("system.html");
			})

			//"人员"按钮监听
			var personFlag = true
			btnPerson.click(function() {
				if (personFlag) {
					mapService.initVector_person_Layer()
					// document.getElementById("btn-person").classList.add("userClassName")
					personFlag = false
				} else {
					mapService.clear_person_Layer()
					// document.getElementById("btn-person").classList.remove("userClassName")
					personFlag = true
				}
			})
			//"定位"按钮监听
			locationImg.click(function() {
				console.log('定位开始')
				mapService.nativeLocation();
			})
		}

		function getGeoResultInfo(geocoderResult) {
			console.log("详细的地理位置信息--->" + JSON.stringify(geocoderResult));
			this.geocoderResult = geocoderResult;
			var promise = inspectOutfalReportInfoService.getRiverNameList('getRiverNameList', geocoderResult);
			promise.then(function(ret) {
				var data = ret.data;
				// console.log("data--->"+JSON.stringify(data));
				var riverNameAndLevel = data;
				var riverNameList = [];
				for (var i = 0; i < data.length; i++) {
					riverNameList.push(data[i].riverName);
				}
				geocoderResult.riverNameList = riverNameList;
				geocoderResult.riverNameAndLevel = riverNameAndLevel;
			}, function(ret) {
				// mui.toast(ret.msg);
			});
		}

		/**
		 * 查询字典表、河道取证信息
		 */
		function initNetworkData() {
			//查询字典表信息
			getDictInfo();

			//启动定时上传任务
			// initUploadService();

			//获取河道取证信息
			// getInspectWaterQualityInfo();
		}

		function getInspectWaterQualityInfo() {
			var promise = inspectWaterQualityInfoService.getInspectWaterQualityInfo();
			promise.then(function(ret) {
				var data = ret.data.items;
				var waterEvidenceData = JSON.stringify(ret.data.items);
				app.setSetting("waterEvidenceData", waterEvidenceData);
				// console.log(JSON.stringify(waterEvidenceData));
			}, function(ret) {
				mui.toast(ret.msg);
			});
		}

		function getDictInfo() {
			var promise = dictService.getDictInfo();
			promise.then(function(ret) {
				var data = ret.data;
				// console.log(JSON.stringify(data));
				var dictionary = data[0];
				app.setSetting("dictionary", dictionary);

				var dictionaryKey = data[1];
				var dictionaryKeyReverse = data[2];
				app.setSetting("dictionaryKey", dictionaryKey);
				app.setSetting("dictionaryKeyReverse", dictionaryKeyReverse);
			}, function(ret) {
				//then方法接收的第二个函数就是容器中的reject函数
				mui.toast(ret.msg);
			});
		}

		function initUploadService() {
			app.setSetting("intervalFlag", true);
			uploadService.upload(uploadInterval, this.getUploadCode);
		}

		function getUploadCode(code) {
			console.log("---》刷新图层数据！")
			currentWebview.reload(true); //设置页面重新加载项(默认为false，改为true)
			// mapService.initVectorLayer();
		}
	</script>
</html>
